<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Bônus</title>

<!-- jsPDF para gerar PDF REAL -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
    body {
        font-family: Arial;
        padding: 20px;
        background: #f5f5f5;
    }
    .card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 0 8px #ccc;
        margin-bottom: 10px;
    }
    input, button {
        width: 100%;
        padding: 12px;
        margin-top: 10px;
        border-radius: 6px;
        border: 1px solid #aaa;
        font-size: 16px;
    }
    button {
        background: black;
        color: white;
        cursor: pointer;
    }
    .codigo {
        font-weight: bold;
        color: green;
    }
</style>
</head>
<body>

<h2>Sistema de Bônus - Gênesis Azulejista</h2>

<div class="card">
    <h3>Gerar Bônus</h3>

    <label>Nome do Cliente:</label>
    <input id="cliente">

    <label>WhatsApp do Cliente:</label>
    <input id="whats">

    <button onclick="gerarBonus()">Gerar Bônus</button>
</div>

<h3>Registros:</h3>
<div id="lista"></div>

<script>
// --------------------------------------------------------
// CÓDIGO QUE NUNCA REPETE (Código Único)
// --------------------------------------------------------
function gerarCodigoUnico() {
    let agora = new Date();
    let ano = agora.getFullYear().toString().slice(-2);
    let mes = (agora.getMonth() + 1).toString().padStart(2, "0");
    let dia = agora.getDate().toString().padStart(2, "0");
    let hora = agora.getHours().toString().padStart(2, "0");
    let min = agora.getMinutes().toString().padStart(2, "0");
    let seg = agora.getSeconds().toString().padStart(2, "0");
    let ms = agora.getMilliseconds().toString().padStart(3, "0");
    let random = Math.floor(Math.random() * 9999).toString().padStart(4, "0");

    return "BNS-" + ano + mes + dia + hora + min + seg + ms + "-" + random;
}

// --------------------------------------------------------
// Salvar e carregar lista
// --------------------------------------------------------
function carregarLista() {
    return JSON.parse(localStorage.getItem("bonus") || "[]");
}

function salvarLista(lista) {
    localStorage.setItem("bonus", JSON.stringify(lista));
}

function mostrarLista() {
    let lista = carregarLista();
    let html = "";

    lista.forEach((b, i) => {
        html += `
        <div class='card'>
            <strong>Cliente:</strong> ${b.cliente}<br>
            <strong>WhatsApp:</strong> ${b.whats}<br>
            <strong>Código:</strong> <span class="codigo">${b.codigo}</span><br>
            <strong>Data:</strong> ${b.data}<br><br>

            <button onclick="baixarPDF(${i})">Baixar Comprovante PDF</button>
        </div>
        `;
    });

    document.getElementById("lista").innerHTML = html;
}

// --------------------------------------------------------
// Gerar bônus
// --------------------------------------------------------
function gerarBonus() {
    let cliente = document.getElementById("cliente").value.trim();
    let whats = document.getElementById("whats").value.trim();

    if (cliente === "" || whats === "") {
        alert("Preencha todos os campos!");
        return;
    }

    let codigo = gerarCodigoUnico();

    let registro = {
        cliente: cliente,
        whats: whats,
        codigo: codigo,
        data: new Date().toLocaleString()
    };

    let lista = carregarLista();
    lista.push(registro);
    salvarLista(lista);

    mostrarLista();
    alert("Bônus gerado com sucesso!");
}

// --------------------------------------------------------
// Gerar PDF REAL com jsPDF
// --------------------------------------------------------
async function baixarPDF(i) {
    const { jsPDF } = window.jspdf;
    let lista = carregarLista();
    let b = lista[i];

    let doc = new jsPDF();

    doc.setFontSize(20);
    doc.text("COMPROVANTE DE BÔNUS", 10, 20);

    doc.setFontSize(12);
    doc.text(`Cliente: ${b.cliente}`, 10, 40);
    doc.text(`WhatsApp: ${b.whats}`, 10, 50);
    doc.text(`Código do Bônus: ${b.codigo}`, 10, 60);
    doc.text(`Data: ${b.data}`, 10, 70);

    doc.text("Primeira contratação: 15% de desconto", 10, 90);
    doc.text("Cada indicação confirmada gera R$ 200 de bônus", 10, 100);
    doc.text("Bônus pode ser trocado por serviços", 10, 110);

    doc.text("Prestador: Gênesis Azulejista", 10, 130);
    doc.text("WhatsApp: (32) 99543-9612", 10, 140);

    doc.save(`comprovante_${b.codigo}.pdf`);
}

mostrarLista();
</script>

</body>
</html>
